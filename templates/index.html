<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Radar Dashboard</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0f1419;
            color: #e7e9ea;
            line-height: 1.5;
        }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        header {
            background: linear-gradient(135deg, #1a1f2e 0%, #0f1419 100%);
            padding: 30px 0;
            border-bottom: 1px solid #2f3336;
            margin-bottom: 30px;
        }
        h1 { font-size: 2rem; font-weight: 700; }
        h1 span { color: #00d4aa; }
        h2 { font-size: 1.25rem; margin-bottom: 15px; color: #8899a6; }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: #1a1f2e;
            border-radius: 12px;
            padding: 20px;
            border: 1px solid #2f3336;
        }
        .stat-card .label { color: #8899a6; font-size: 0.875rem; }
        .stat-card .value { font-size: 2rem; font-weight: 700; color: #00d4aa; }

        .card {
            background: #1a1f2e;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #2f3336;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .tab {
            padding: 10px 20px;
            background: #2f3336;
            border: none;
            border-radius: 8px;
            color: #e7e9ea;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .tab:hover { background: #3a3f44; }
        .tab.active { background: #00d4aa; color: #0f1419; }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #2f3336;
        }
        th { color: #8899a6; font-weight: 600; }
        tr:hover { background: rgba(0, 212, 170, 0.05); }

        .positive { color: #00d4aa; }
        .negative { color: #f4212e; }

        .ticker {
            font-weight: 700;
            color: #1d9bf0;
        }

        .breakdown-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .bar {
            height: 8px;
            background: #2f3336;
            border-radius: 4px;
            margin-top: 8px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            background: #00d4aa;
            border-radius: 4px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #2f3336;
        }
        .summary-row:last-child { border-bottom: none; }

        .loading { text-align: center; padding: 40px; color: #8899a6; }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1><span>Stock</span> Radar</h1>
            <p style="color: #8899a6; margin-top: 5px;">Insider Trading Signal Validation Dashboard</p>
        </div>
    </header>

    <div class="container">
        <!-- Stats -->
        <div class="stats-grid" id="stats">
            <div class="stat-card">
                <div class="label">Insider Trades</div>
                <div class="value" id="stat-trades">-</div>
            </div>
            <div class="stat-card">
                <div class="label">Validated Events</div>
                <div class="value" id="stat-events">-</div>
            </div>
            <div class="stat-card">
                <div class="label">Signals Generated</div>
                <div class="value" id="stat-signals">-</div>
            </div>
            <div class="stat-card">
                <div class="label">Date Range</div>
                <div class="value" id="stat-dates" style="font-size: 1rem;">-</div>
            </div>
        </div>

        <!-- Validation Summary -->
        <div class="card">
            <h2>Validation Summary</h2>
            <div id="validation-summary" class="loading">Loading...</div>
        </div>

        <!-- Performance Breakdown -->
        <div class="breakdown-grid">
            <div class="card">
                <h2>By Insider Type</h2>
                <div id="by-insider-type" class="loading">Loading...</div>
            </div>
            <div class="card">
                <h2>By Buy Size</h2>
                <div id="by-buy-size" class="loading">Loading...</div>
            </div>
        </div>

        <!-- Trades Tables -->
        <div class="card">
            <div class="tabs">
                <button class="tab active" onclick="showTab('top')">Top Performers</button>
                <button class="tab" onclick="showTab('worst')">Worst Performers</button>
                <button class="tab" onclick="showTab('recent')">Recent Trades</button>
            </div>

            <div id="tab-top">
                <table>
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Buy Value</th>
                            <th>5D Return</th>
                            <th>5D Excess</th>
                            <th>10D Return</th>
                            <th>10D Excess</th>
                        </tr>
                    </thead>
                    <tbody id="top-signals"></tbody>
                </table>
            </div>

            <div id="tab-worst" style="display: none;">
                <table>
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Date</th>
                            <th>Type</th>
                            <th>Buy Value</th>
                            <th>5D Return</th>
                            <th>5D Excess</th>
                            <th>10D Return</th>
                            <th>10D Excess</th>
                        </tr>
                    </thead>
                    <tbody id="worst-signals"></tbody>
                </table>
            </div>

            <div id="tab-recent" style="display: none;">
                <table>
                    <thead>
                        <tr>
                            <th>Ticker</th>
                            <th>Insider</th>
                            <th>Title</th>
                            <th>Type</th>
                            <th>Shares</th>
                            <th>Price</th>
                            <th>Value</th>
                            <th>Trade Date</th>
                        </tr>
                    </thead>
                    <tbody id="recent-trades"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Format helpers
        const fmt = {
            pct: (v) => v != null ? (v >= 0 ? '+' : '') + (v * 100).toFixed(2) + '%' : '-',
            money: (v) => v != null ? '$' + Number(v).toLocaleString(undefined, {maximumFractionDigits: 0}) : '-',
            num: (v) => v != null ? Number(v).toLocaleString() : '-'
        };

        const colorClass = (v) => v > 0 ? 'positive' : v < 0 ? 'negative' : '';

        // Load stats
        fetch('/api/stats')
            .then(r => r.json())
            .then(data => {
                document.getElementById('stat-trades').textContent = fmt.num(data.insider_trades);
                document.getElementById('stat-events').textContent = fmt.num(data.validation_events);
                document.getElementById('stat-signals').textContent = fmt.num(data.signals);
                document.getElementById('stat-dates').textContent =
                    (data.date_range.min || '-') + ' to ' + (data.date_range.max || '-');
            });

        // Load validation summary
        fetch('/api/validation-results')
            .then(r => r.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('validation-summary').innerHTML = '<p>' + data.error + '</p>';
                    return;
                }
                const overall = data.overall || {};
                let html = '';
                ['1d', '3d', '5d', '10d', '20d'].forEach(period => {
                    const p = overall[period] || {};
                    html += `
                        <div class="summary-row">
                            <span><strong>${period.toUpperCase()}</strong></span>
                            <span>Return: <span class="${colorClass(p.avg_return)}">${fmt.pct(p.avg_return)}</span></span>
                            <span>Excess: <span class="${colorClass(p.avg_excess)}">${fmt.pct(p.avg_excess)}</span></span>
                            <span>Win Rate: <strong>${p.win_rate ? p.win_rate.toFixed(1) + '%' : '-'}</strong></span>
                            <span>P-Value: ${p.p_value != null ? p.p_value.toFixed(4) : '-'}</span>
                        </div>
                    `;
                });
                document.getElementById('validation-summary').innerHTML = html;
            });

        // Load by insider type
        fetch('/api/by-insider-type')
            .then(r => r.json())
            .then(data => {
                let html = '';
                data.forEach(row => {
                    const winRate = row.win_rate_5d || 0;
                    html += `
                        <div class="summary-row">
                            <span><strong>${row.insider_type}</strong> (${row.count})</span>
                            <span class="${colorClass(row.avg_excess_5d)}">${fmt.pct(row.avg_excess_5d)}</span>
                        </div>
                        <div class="bar"><div class="bar-fill" style="width: ${winRate}%"></div></div>
                        <div style="font-size: 0.75rem; color: #8899a6; margin-bottom: 10px;">${winRate.toFixed(1)}% win rate</div>
                    `;
                });
                document.getElementById('by-insider-type').innerHTML = html;
            });

        // Load by buy size
        fetch('/api/by-buy-size')
            .then(r => r.json())
            .then(data => {
                let html = '';
                data.forEach(row => {
                    const winRate = row.win_rate_5d || 0;
                    html += `
                        <div class="summary-row">
                            <span><strong>${row.size_bucket}</strong> (${row.count})</span>
                            <span class="${colorClass(row.avg_excess_5d)}">${fmt.pct(row.avg_excess_5d)}</span>
                        </div>
                        <div class="bar"><div class="bar-fill" style="width: ${winRate}%"></div></div>
                        <div style="font-size: 0.75rem; color: #8899a6; margin-bottom: 10px;">${winRate.toFixed(1)}% win rate</div>
                    `;
                });
                document.getElementById('by-buy-size').innerHTML = html;
            });

        // Load signals table
        function loadSignals(endpoint, elementId) {
            fetch(endpoint)
                .then(r => r.json())
                .then(data => {
                    let html = '';
                    data.forEach(row => {
                        html += `
                            <tr>
                                <td class="ticker">${row.ticker}</td>
                                <td>${row.signal_date}</td>
                                <td>${row.insider_type || '-'}</td>
                                <td>${fmt.money(row.buy_value)}</td>
                                <td class="${colorClass(row.return_5d)}">${fmt.pct(row.return_5d)}</td>
                                <td class="${colorClass(row.excess_5d)}">${fmt.pct(row.excess_5d)}</td>
                                <td class="${colorClass(row.return_10d)}">${fmt.pct(row.return_10d)}</td>
                                <td class="${colorClass(row.excess_10d)}">${fmt.pct(row.excess_10d)}</td>
                            </tr>
                        `;
                    });
                    document.getElementById(elementId).innerHTML = html;
                });
        }

        loadSignals('/api/top-signals', 'top-signals');
        loadSignals('/api/worst-signals', 'worst-signals');

        // Load recent trades
        fetch('/api/recent-trades')
            .then(r => r.json())
            .then(data => {
                let html = '';
                data.forEach(row => {
                    html += `
                        <tr>
                            <td class="ticker">${row.ticker}</td>
                            <td>${row.insider_name || '-'}</td>
                            <td>${row.insider_title || '-'}</td>
                            <td>${row.trade_type === 'P' ? 'Buy' : 'Sell'}</td>
                            <td>${fmt.num(row.shares)}</td>
                            <td>${row.price_per_share ? '$' + row.price_per_share.toFixed(2) : '-'}</td>
                            <td>${fmt.money(row.total_value)}</td>
                            <td>${row.trade_date}</td>
                        </tr>
                    `;
                });
                document.getElementById('recent-trades').innerHTML = html;
            });

        // Tab switching
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('[id^="tab-"]').forEach(t => t.style.display = 'none');
            document.querySelector(`[onclick="showTab('${tab}')"]`).classList.add('active');
            document.getElementById('tab-' + tab).style.display = 'block';
        }
    </script>
</body>
</html>
